webpackJsonp([0xcd63b8c80a79],{520:function(n,s){n.exports={data:{site:{siteMetadata:{title:"Elvin's Blog",author:"Elvin Ma"}},markdownRemark:{id:"/Users/maxingcong/Code/blog/src/pages/用D3力导向图做思维导图.md absPath of file >>> MarkdownRemark",html:'<p>最近两天在书店看完了《精通D3.js：交互式数据可视化高级编程》和一本讲解思维导思的书，于是便着手用D3.js来实现一个自用的思维导图</p>\n<h3>D3.js</h3>\n<p>D3.js，Data-Driver-Document数据驱动文档，是一个用来做数据可视化的js库；数据可视化是指，用交互的/可视化的方式对抽象数据进行展示，已达到数据认知的目的，可以帮助我们揭示数据的意义；D3.js 闻名已久，它比Processing这样的底层绘图简单，比Echarts这样的高度封装的图表库更自由，也就是提供了一个不是特别底层，也不是高度封装的库，能够给使用者很好地发挥空间，同时学习成本也不大</p>\n<h3>数据与图形</h3>\n<p>理解D3.js的数据与图形的关系，最重要的是理解 enter-updte-exit（进入-更新-退出）模式</p>\n<p>通过enter函数可以返回一个集合，这个集合里面包含的就是没有被可是可视化的数据，这也是数据可视化的第一步操作，先找到那些没有被可视化的数据；</p>\n<p>通过update函数可以找出图像和数据有交集的部分，也就是之前数据所对应的图形，通过data函数，可以选择出交集集合，然后对选择出的集合进行操作，对元素进行更新；</p>\n<p>通过exit函数可以选择出没有关联任何数据的图形，可以调用相关函数来更新或是删除</p>\n<p>以下是一个简单的柱状图案例：</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//定义数据</span>\n\n<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//render函数来更新图表</span>\n    <span class="token comment">// Enter</span>\n    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">"div.h-bar"</span><span class="token punctuation">)</span> <span class="token comment">// 选择出图形元素的集合</span>\n        <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 将数组绑定到将要创建的图形元素上</span>\n        <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 选择没有被可视化的数据元素，第一次调用选中的是所有的数据</span>\n        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"h-bar"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Update</span>\n    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">"div.h-bar"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment">// 得到数据集合和图形集合的交集</span>\n        <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 对数据关联的图形更改属性，形参d代表与对应图形元素关联的数据值</span>\n            <span class="token keyword">return</span> <span class="token punctuation">(</span>d <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span> <span class="token comment">// 子元素能拿到父级元素的值</span>\n        <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> d<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            \n    <span class="token comment">// Exit</span>\n    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">"div.h-bar"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//移除没有任何数据关联的图形元素</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 循环绘制</span>\n<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> \n    data<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>在所有append操作和select操作时，D3会为每一个数据创建或者变更对应用的元素，并为元素添加了<code class="language-text">__data__</code>属性，这个属性的值为其绑定的数据值</p>\n<h3>力导向图</h3>\n<p>力导向图（Force-Directed Graph）是D3的图形布局中非常热门的一种，它的绘图算法是，在二维或三维空间里配置节点，节点之间用线连接，各连线的长度几乎相等，且尽可能不相交。节点和连线都被施加了力的作用，力是根据节点和连线的相对位置计算的，根据力的作用，来计算节点和连线的运动轨迹，并不断降低它们的能量，最终达到一种能量很低的安定状态</p>\n<p>采用力导向图做思维导图，是因为我觉得增删节点后不用处理排布的问题，整个图形可以拖动，并且会自我趋向稳态，真是很适合懒人的选择</p>\n<p>首先把思维导图的实例化考虑为以下方式来做：</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>mindMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MindMap</span><span class="token punctuation">(</span><span class="token string">\'#MindMap\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>这样可以支持不同框架，也可以支持多个实例，实现MindMap class逻辑比较多，采用svg绘图方式来做，在constructor中要初始化图形</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MindMap</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">\'clientWidth\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">\'clientHeight\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">uid</span> <span class="token operator">=</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type <span class="token operator">||</span> <span class="token string">\'uid\'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>\n    container<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"svg:svg"</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'id\'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uid</span><span class="token punctuation">(</span><span class="token string">\'svg\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data <span class="token operator">||</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">\'mindMapData\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n      nodes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uid</span><span class="token punctuation">(</span><span class="token string">\'node\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">\'root\'</span><span class="token punctuation">,</span> level<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      links<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>svg <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'svg\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>simulation <span class="token operator">=</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">forceSimulation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span><span class="token string">"link"</span><span class="token punctuation">,</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">forceLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>data <span class="token operator">=></span> data<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span><span class="token string">\'charge\'</span><span class="token punctuation">,</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">forceManyBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">strength</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span><span class="token string">\'center\'</span><span class="token punctuation">,</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">forceCenter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span><span class="token string">\'collide\'</span><span class="token punctuation">,</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">forceCollide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">radius</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>linesGroup <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"g"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"links"</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>nodesGroup <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"nodes"</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>palette <span class="token operator">=</span> Palettes<span class="token punctuation">.</span>Blue\n    <span class="token keyword">this</span><span class="token punctuation">.</span>zoomHanlder <span class="token operator">=</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">zoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"zoom"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"transform"</span><span class="token punctuation">,</span> <span class="token constant">D3</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span>transform<span class="token punctuation">)</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">zoomHanlder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>svg<span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>力导向图是通过D3.forceSimulation来做的，通过force方法设置好连接的属性和节点的电荷点，以及图的中心点，同时有一个Palettes类用于存放和设置主题色</p>\n<p>绘制的细节都抽取在update方法中，初次渲染和所有的增删查改操作后要调用 update 方法， </p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>\n  <span class="token operator">...</span>\n  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span>nodes<span class="token punctuation">,</span> links<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data\n    <span class="token keyword">let</span> linesData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>linesGroup\n      <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">\'line\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>links<span class="token punctuation">)</span>\n    <span class="token keyword">let</span> nodesData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodesGroup\n      <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">\'g\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>\n    <span class="token keyword">const</span> linesDataEnter <span class="token operator">=</span> linesData<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'line\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'stroke\'</span><span class="token punctuation">,</span> <span class="token string">\'#999\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> nodesDataEnter <span class="token operator">=</span> nodesData<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'g\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'class\'</span><span class="token punctuation">,</span> <span class="token string">\'node\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>\n        <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">drag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dragStart</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>simulation<span class="token punctuation">)</span><span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'drag\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dragging</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'end\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dragEnd</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>simulation<span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span>\n    <span class="token comment">// Plus Icon</span>\n    nodesDataEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'image\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'class\'</span><span class="token punctuation">,</span> <span class="token string">\'plus\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'xlink:href\'</span><span class="token punctuation">,</span> plusImage<span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'width\'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'height\'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token constant">D3</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token comment">// Edit Icon</span>\n    nodesDataEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'image\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'class\'</span><span class="token punctuation">,</span> <span class="token string">\'edit\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'xlink:href\'</span><span class="token punctuation">,</span> editImage<span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'width\'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'height\'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token constant">D3</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token comment">// Delete Icon</span>\n    nodesDataEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'image\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'class\'</span><span class="token punctuation">,</span> <span class="token string">\'delete\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'xlink:href\'</span><span class="token punctuation">,</span> deleteImage<span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'width\'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'height\'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token constant">D3</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> index<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token comment">// Node Rect</span>\n    nodesDataEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'rect\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'width\'</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'height\'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'rx\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'ry\'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n    <span class="token comment">// Node Text</span>\n    nodesDataEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'text\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'fill\'</span><span class="token punctuation">,</span> <span class="token string">\'#fefefe\'</span><span class="token punctuation">)</span>\n    <span class="token comment">// Node Title</span>\n    nodesDataEnter<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'title\'</span><span class="token punctuation">)</span>\n\n    linesData<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    linesData <span class="token operator">=</span> linesDataEnter<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>linesData<span class="token punctuation">)</span>\n    nodesData <span class="token operator">=</span> nodesDataEnter<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>nodesData<span class="token punctuation">)</span>\n    <span class="token comment">// Update Data</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'g\'</span><span class="token punctuation">)</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'.plus\'</span><span class="token punctuation">)</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'.edit\'</span><span class="token punctuation">)</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'.delete\'</span><span class="token punctuation">)</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'rect\'</span><span class="token punctuation">)</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'text\'</span><span class="token punctuation">)</span>\n    nodesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'title\'</span><span class="token punctuation">)</span>\n    linesData<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'line\'</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">ticked</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      linesData<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'x1\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>source<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'y1\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>source<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'x2\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>target<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'y2\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>target<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      nodesData<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'transform\'</span><span class="token punctuation">,</span> data <span class="token operator">=></span> <span class="token template-string"><span class="token string">`translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">)</span>\n      nodesData<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">\'rect\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'fill\'</span><span class="token punctuation">,</span> d <span class="token operator">=></span> <span class="token number">6</span> <span class="token operator">-</span> d<span class="token punctuation">.</span>level <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>palette<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>palette<span class="token punctuation">[</span><span class="token number">6</span> <span class="token operator">-</span> d<span class="token punctuation">.</span>level<span class="token punctuation">]</span><span class="token punctuation">)</span>\n      nodesData<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">\'title\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data <span class="token operator">=></span> data<span class="token punctuation">.</span>content<span class="token punctuation">)</span>\n      nodesData<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">\'text\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getComputedTextLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          el<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          el<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'\\u2026\'</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>simulation<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'tick\'</span><span class="token punctuation">,</span> ticked<span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>simulation<span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span><span class="token string">\'link\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">links</span><span class="token punctuation">(</span>links<span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>simulation<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>simulation<span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>simulation<span class="token punctuation">.</span><span class="token function">alpha</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token operator">...</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>这里的数据集合是data里的一个nodes和一个links对象数组，这里遇到的一个问题是需要手动select所有的节点和线来保证数据的更新和准确对应， 最后simulation中的tick回调是每一帧绘图时的回调，通过设置alpha和friction等属性，并在回调中根据当前位置计算绘图，可以实现图形变换的过滤动效</p>\n<p>最后加上一个export方法来导出图片和将数据集存储到localStorage:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>\n  <span class="token operator">...</span>\n  <span class="token keyword">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">XMLSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serializeToString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>svg<span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>source<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token string">\'image/svg+xml;charset=utf-8\'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth\n    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight\n    <span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>\n      <span class="token keyword">const</span> pngUrl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">"image/png"</span><span class="token punctuation">)</span>\n      <span class="token keyword">const</span> downloadLink <span class="token operator">=</span> <span class="token constant">D3</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      downloadLink<span class="token punctuation">.</span>href <span class="token operator">=</span> pngUrl\n      downloadLink<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">\'mindmap\'</span>\n      downloadLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      canvas<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      downloadLink<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    image<span class="token punctuation">.</span>src <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>\n      nodes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>nodes<span class="token punctuation">,</span>\n      links<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>links<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>source<span class="token punctuation">:</span> item<span class="token punctuation">.</span>source<span class="token punctuation">.</span>id<span class="token punctuation">,</span> target<span class="token punctuation">:</span> item<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">\'mindMapData\'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token operator">...</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>最新的效果可见：<a href="https://silentmaker.github.io/mind-map/">Mind Map</a></p>',
frontmatter:{title:"用D3力导向图做思维导图",tags:["javascript"],categories:["dev"],date:"June 20, 2018"}}},pathContext:{slug:"/用D3力导向图做思维导图/",previous:{fields:{slug:"/页面渲染问题总结/"},frontmatter:{path:"/render-performance-checklist",title:"页面渲染问题总结",tags:["性能"],categories:["编程"]}},next:{fields:{slug:"/Web Worker笔记/"},frontmatter:{path:"/web-workers-notes",title:"Web Workers笔记",tags:["Web","Javascript"],categories:["编程"]}}}}}});
//# sourceMappingURL=path---用-d-3-力导向图做思维导图-3cb78d5a8e8cbcfe265e.js.map